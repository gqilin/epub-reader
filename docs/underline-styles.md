# ä¸‹åˆ’çº¿è‡ªå®šä¹‰æ ·å¼åŠŸèƒ½è¯´æ˜

## ğŸ¨ åŠŸèƒ½æ¦‚è¿°

ç°åœ¨ä¸‹åˆ’çº¿æ ‡è®°æ”¯æŒå¤šç§è‡ªå®šä¹‰æ ·å¼ï¼Œä¸å†å±€é™äºç®€å•çš„å•ä¸€ç›´çº¿ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©å®çº¿ã€è™šçº¿ã€ç‚¹çº¿ã€æ³¢æµªçº¿ã€åŒçº¿å’Œç²—çº¿ç­‰å¤šç§æ ·å¼æ¥æ»¡è¶³ä¸åŒçš„æ ‡è®°éœ€æ±‚ã€‚

## âœ¨ æ”¯æŒçš„æ ·å¼

### 1. ğŸ“ å®çº¿ (Solid)
- **æ ·å¼**ï¼šä¼ ç»Ÿçš„ç›´çº¿å‹ä¸‹åˆ’çº¿
- **å‚æ•°**ï¼š`thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤2px)
- **é€‚ç”¨åœºæ™¯**ï¼šé€šç”¨æ ‡è®°ï¼Œæ­£å¼æ–‡æ¡£
- **SVGå®ç°**ï¼š`<line>` å…ƒç´ 

### 2. â– è™šçº¿ (Dashed)
- **æ ·å¼**ï¼šç”±çŸ­çº¿æ®µç»„æˆçš„è™šçº¿
- **å‚æ•°**ï¼š
  - `thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤2px)
  - `dashPattern` (è™šçº¿å›¾æ¡ˆï¼Œé»˜è®¤"8,4")
- **é€‚ç”¨åœºæ™¯**ï¼šä¸´æ—¶æ ‡è®°ï¼Œå¾…åŠäº‹é¡¹
- **SVGå®ç°**ï¼š`<line stroke-dasharray="8,4">`

### 3. âš« ç‚¹çº¿ (Dotted)
- **æ ·å¼**ï¼šç”±ç‚¹ç»„æˆçš„ç‚¹çº¿
- **å‚æ•°**ï¼š`thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤2px)
- **é€‚ç”¨åœºæ™¯**ï¼šè½»å¾®æ ‡è®°ï¼Œæ³¨é‡Šæé†’
- **SVGå®ç°**ï¼š`<line stroke-dasharray="2,3" stroke-linecap="round">`

### 4. ã€°ï¸ æ³¢æµªçº¿ (Wavy)
- **æ ·å¼**ï¼šä¼˜ç¾çš„æ³¢æµªå½¢ä¸‹åˆ’çº¿
- **å‚æ•°**ï¼š
  - `thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤2px)
  - `waveAmplitude` (æ³¢æµªæŒ¯å¹…ï¼Œé»˜è®¤3px)
  - `waveFrequency` (æ³¢æµªé¢‘ç‡ï¼Œé»˜è®¤0.1)
- **é€‚ç”¨åœºæ™¯**ï¼šé‡è¦æ ‡è®°ï¼Œå¼ºè°ƒå†…å®¹
- **SVGå®ç°**ï¼š`<path>` å…ƒç´ ï¼Œä½¿ç”¨æ­£å¼¦å‡½æ•°ç”Ÿæˆè·¯å¾„

### 5. â•â• åŒçº¿ (Double)
- **æ ·å¼**ï¼šä¸¤æ¡å¹³è¡Œçš„ä¸‹åˆ’çº¿
- **å‚æ•°**ï¼š
  - `thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤2px)
  - `spacing` (åŒçº¿é—´è·ï¼Œé»˜è®¤3px)
- **é€‚ç”¨åœºæ™¯**ï¼šé‡ç‚¹æ ‡è®°ï¼Œæ ‡é¢˜å¼ºè°ƒ
- **SVGå®ç°**ï¼š`<g>` åŒ…å«ä¸¤ä¸ª `<line>` å…ƒç´ 

### 6. â–¬ ç²—çº¿ (Thick)
- **æ ·å¼**ï¼šåŠ ç²—çš„çŸ©å½¢ä¸‹åˆ’çº¿
- **å‚æ•°**ï¼š`thickness` (çº¿æ¡ç²—ç»†ï¼Œé»˜è®¤4px)
- **é€‚ç”¨åœºæ™¯**ï¼šæœ€é«˜ä¼˜å…ˆçº§æ ‡è®°ï¼Œè­¦å‘Šæç¤º
- **SVGå®ç°**ï¼š`<rect>` å…ƒç´ 

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### ç±»å‹å®šä¹‰

```typescript
// ä¸‹åˆ’çº¿æ ·å¼ç±»å‹
export type UnderlineStyle = 
  | 'solid'     // å®çº¿
  | 'dashed'    // è™šçº¿
  | 'dotted'    // ç‚¹çº¿
  | 'wavy'      // æ³¢æµªçº¿
  | 'double'    // åŒçº¿
  | 'thick'     // ç²—çº¿
  | 'custom';   // è‡ªå®šä¹‰

// ä¸‹åˆ’çº¿é…ç½®
export interface UnderlineConfig {
  style: UnderlineStyle;
  color?: string;
  thickness?: number;        // çº¿æ¡ç²—ç»†
  waveAmplitude?: number;    // æ³¢æµªæŒ¯å¹…
  waveFrequency?: number;    // æ³¢æµªé¢‘ç‡
  dashPattern?: string;      // è™šçº¿å›¾æ¡ˆ
  spacing?: number;          // åŒçº¿é—´è·
}
```

### æ ‡è®°æ•°æ®ç»“æ„

```typescript
interface Annotation {
  id: string;
  type: AnnotationType;
  cfi: CFI;
  text: string;
  color?: string;
  note?: string;
  createdAt: Date;
  updatedAt: Date;
  chapterId: string;
  pageNumber?: number;
  // ä¸‹åˆ’çº¿ä¸“ç”¨é…ç½®
  underlineConfig?: UnderlineConfig;
}
```

### SVGæ¸²æŸ“å®ç°

æ¯ç§æ ·å¼éƒ½æœ‰ä¸“é—¨çš„SVGç”Ÿæˆæ–¹æ³•ï¼š

```typescript
// æ³¢æµªçº¿å®ç°ç¤ºä¾‹
private createWavyUnderline(
  annotation: Annotation, 
  x: number, y: number, width: number, height: number, 
  color: string, config: UnderlineConfig
): SVGPathElement {
  const amplitude = config.waveAmplitude || 3;
  const frequency = config.waveFrequency || 0.1;
  
  let pathData = `M ${x} ${y + height}`;
  const steps = Math.ceil(width / 2);
  
  for (let i = 0; i <= steps; i++) {
    const currentX = x + (width * i / steps);
    const waveY = (y + height) + Math.sin(i * frequency * Math.PI * 2) * amplitude;
    pathData += ` L ${currentX} ${waveY}`;
  }
  
  const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  path.setAttribute('d', pathData);
  path.setAttribute('stroke', color);
  path.setAttribute('stroke-width', String(config.thickness || 2));
  path.setAttribute('fill', 'none');
  
  return path;
}
```

## ğŸ¯ ç”¨æˆ·ç•Œé¢

### å·¥å…·æ äº¤äº’

1. **ç‚¹å‡»ä¸‹åˆ’çº¿æŒ‰é’®**ï¼šå±•å¼€æ ·å¼é€‰æ‹©èœå•
2. **é€‰æ‹©æ ·å¼**ï¼šç‚¹å‡»èœå•ä¸­çš„æ ·å¼é€‰é¡¹
3. **å®æ—¶é¢„è§ˆ**ï¼šèœå•ä¸­æ˜¾ç¤ºæ ·å¼çš„SVGé¢„è§ˆå›¾
4. **è‡ªåŠ¨åº”ç”¨**ï¼šé€‰æ‹©åç«‹å³åº”ç”¨åˆ°é€‰ä¸­çš„æ–‡å­—

### æ ·å¼èœå•è®¾è®¡

```html
<div class="underline-menu">
  <div class="underline-option">
    <svg width="40" height="10">
      <!-- æ ·å¼é¢„è§ˆSVG -->
    </svg>
    <span>æ ·å¼åç§°</span>
  </div>
  <!-- å…¶ä»–é€‰é¡¹... -->
</div>
```

### å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯**ï¼šå®Œæ•´çš„6ä¸ªæ ·å¼é€‰é¡¹
- **ç§»åŠ¨ç«¯**ï¼šä¼˜åŒ–çš„è§¦æ‘¸ç•Œé¢ï¼Œä¿æŒåŠŸèƒ½å®Œæ•´
- **é€‚é…æ€§**ï¼šæ‰€æœ‰å±å¹•å°ºå¯¸ä¸‹éƒ½èƒ½æ­£å¸¸ä½¿ç”¨

## ğŸ§ª æµ‹è¯•éªŒè¯

### è‡ªåŠ¨åŒ–æµ‹è¯•

åˆ›å»ºäº†ä¸“é—¨çš„æµ‹è¯•è„šæœ¬ `test-underline-styles.js`ï¼š

```javascript
// æµ‹è¯•æ‰€æœ‰æ ·å¼
testUnderlineStyles();

// æ€§èƒ½æµ‹è¯•
testUnderlinePerformance();

// ä¸€é”®è¿è¡Œ
runAllUnderlineTests();
```

### æµ‹è¯•å†…å®¹

1. **æ ·å¼æ¸²æŸ“æµ‹è¯•**ï¼šéªŒè¯æ¯ç§æ ·å¼çš„SVGç”Ÿæˆ
2. **å‚æ•°é…ç½®æµ‹è¯•**ï¼šéªŒè¯è‡ªå®šä¹‰å‚æ•°çš„æ•ˆæœ
3. **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•å¤æ‚æ ·å¼çš„æ¸²æŸ“æ€§èƒ½
4. **å…¼å®¹æ€§æµ‹è¯•**ï¼šéªŒè¯åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„æ˜¾ç¤ºæ•ˆæœ

### è°ƒè¯•ä¿¡æ¯

åœ¨è°ƒè¯•é¢æ¿ä¸­å¢åŠ äº†ä¸‹åˆ’çº¿æ ·å¼ç»Ÿè®¡ï¼š

```
ä¸‹åˆ’çº¿æ ·å¼åˆ†å¸ƒ
å®çº¿ï¼š3 ä¸ª
è™šçº¿ï¼š2 ä¸ª
ç‚¹çº¿ï¼š1 ä¸ª
æ³¢æµªçº¿ï¼š4 ä¸ª
åŒçº¿ï¼š2 ä¸ª
ç²—çº¿ï¼š1 ä¸ª
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨

1. **å¯ç”¨æ ‡è®°åŠŸèƒ½**ï¼šç‚¹å‡»"ğŸ“ æ ‡è®°"æŒ‰é’®
2. **é€‰æ‹©æ–‡å­—**ï¼šåœ¨ç« èŠ‚ä¸­é€‰æ‹©è¦æ ‡è®°çš„æ–‡å­—
3. **å±•å¼€ä¸‹åˆ’çº¿èœå•**ï¼šç‚¹å‡»å·¥å…·æ ä¸­çš„"UÌ² ä¸‹åˆ’çº¿"æŒ‰é’®
4. **é€‰æ‹©æ ·å¼**ï¼šä»èœå•ä¸­é€‰æ‹©æ‰€éœ€æ ·å¼
5. **åº”ç”¨æ ‡è®°**ï¼šæ ·å¼ä¼šç«‹å³åº”ç”¨åˆ°é€‰ä¸­çš„æ–‡å­—

### é«˜çº§é…ç½®

é€šè¿‡ä»£ç å¯ä»¥è‡ªå®šä¹‰æ ·å¼å‚æ•°ï¼š

```typescript
// åˆ›å»ºè‡ªå®šä¹‰æ³¢æµªçº¿
await reader.createAnnotationFromSelection('underline', {
  color: '#ff5722',
  underlineStyle: 'wavy',
  underlineConfig: {
    style: 'wavy',
    thickness: 3,
    waveAmplitude: 5,
    waveFrequency: 0.15
  }
});

// åˆ›å»ºè‡ªå®šä¹‰è™šçº¿
await reader.createAnnotationFromSelection('underline', {
  color: '#4caf50',
  underlineStyle: 'dashed',
  underlineConfig: {
    style: 'dashed',
    thickness: 2,
    dashPattern: '10,5'
  }
});
```

### æ ·å¼é¢„è®¾

ç³»ç»Ÿæä¾›äº†åˆç†çš„é»˜è®¤å‚æ•°ï¼š

```typescript
const defaultConfigs = {
  solid: { style: 'solid', thickness: 2 },
  dashed: { style: 'dashed', thickness: 2, dashPattern: '8,4' },
  dotted: { style: 'dotted', thickness: 2 },
  wavy: { style: 'wavy', thickness: 2, waveAmplitude: 3, waveFrequency: 0.1 },
  double: { style: 'double', thickness: 2, spacing: 3 },
  thick: { style: 'thick', thickness: 4 }
};
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### æ¸²æŸ“ä¼˜åŒ–

1. **SVGç¼“å­˜**ï¼šç›¸åŒé…ç½®çš„æ ·å¼å¤ç”¨SVGå…ƒç´ 
2. **å»¶è¿ŸåŠ è½½**ï¼šå¤æ‚çš„æ³¢æµªçº¿æ ·å¼å»¶è¿Ÿæ¸²æŸ“
3. **æ‰¹é‡å¤„ç†**ï¼šå¤šä¸ªæ ‡è®°åŒæ—¶åˆ›å»ºæ—¶æ‰¹é‡å¤„ç†

### å†…å­˜ç®¡ç†

1. **å…ƒç´ å¤ç”¨**ï¼šé¿å…é‡å¤åˆ›å»ºç›¸åŒçš„SVGå…ƒç´ 
2. **åŠæ—¶æ¸…ç†**ï¼šç« èŠ‚åˆ‡æ¢æ—¶æ¸…ç†ä¸éœ€è¦çš„æ ·å¼å…ƒç´ 
3. **çŠ¶æ€ç®¡ç†**ï¼šè·Ÿè¸ªæ¸²æŸ“çŠ¶æ€é¿å…é‡å¤æ“ä½œ

## ğŸ¨ æ ·å¼æŒ‡å—

### æ¨èä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ ·å¼ | ç†ç”± |
|------|----------|------|
| é‡è¦å®šä¹‰ | åŒçº¿ | æ˜æ˜¾å¼ºè°ƒï¼Œé€‚åˆæœ¯è¯­æ ‡è®° |
| ä¸´æ—¶å¤‡æ³¨ | è™šçº¿ | æ¸…æ™°ä½†ä¸å¹²æ‰°é˜…è¯» |
| è½»å¾®æç¤º | ç‚¹çº¿ | æœ€å°è§†è§‰å¹²æ‰° |
| é‡ç‚¹å¼ºè°ƒ | æ³¢æµªçº¿ | å¸å¼•æ³¨æ„åŠ› |
| æ­£å¼æ–‡æ¡£ | å®çº¿ | ä¼ ç»Ÿä¸”ä¸“ä¸š |
| è­¦å‘Šæ ‡è®° | ç²—çº¿ | æœ€é«˜ä¼˜å…ˆçº§ |

### é¢œè‰²æ­é…å»ºè®®

```typescript
// ä¸åŒæ ·å¼çš„æ¨èé¢œè‰²
const styleColors = {
  solid: '#2196f3',      // è“è‰² - ä¸“ä¸š
  dashed: '#ff9800',     // æ©™è‰² - æ³¨æ„
  dotted: '#4caf50',     // ç»¿è‰² - æ¸©å’Œ
  wavy: '#9c27b0',       // ç´«è‰² - é‡è¦
  double: '#f44336',     // çº¢è‰² - å¼ºè°ƒ
  thick: '#ff5722'       // æ·±æ©™ - è­¦å‘Š
};
```

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’ä¸­çš„åŠŸèƒ½

1. **è‡ªå®šä¹‰å›¾æ¡ˆ**ï¼šç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰ä¸‹åˆ’çº¿å›¾æ¡ˆ
2. **åŠ¨ç”»æ•ˆæœ**ï¼šä¸‹åˆ’çº¿çš„æ·¡å…¥æ·¡å‡ºåŠ¨ç”»
3. **æ¸å˜è‰²**ï¼šæ”¯æŒæ¸å˜è‰²ä¸‹åˆ’çº¿
4. **3Dæ•ˆæœ**ï¼šç«‹ä½“æ„Ÿçš„ä¸‹åˆ’çº¿æ ·å¼
5. **ä¸»é¢˜ç³»ç»Ÿ**ï¼šä¸åŒé˜…è¯»ä¸»é¢˜çš„æ ·å¼é€‚é…

### æ‰©å±•æ€§è®¾è®¡

```typescript
// è‡ªå®šä¹‰æ ·å¼æ¥å£
interface CustomUnderlineStyle {
  name: string;
  generateSVG: (config: UnderlineConfig) => SVGElement;
  defaultConfig: UnderlineConfig;
}

// æ³¨å†Œè‡ªå®šä¹‰æ ·å¼
function registerCustomStyle(style: CustomUnderlineStyle) {
  // æ³¨å†Œé€»è¾‘
}
```

## ğŸ‰ æ€»ç»“

ä¸‹åˆ’çº¿è‡ªå®šä¹‰æ ·å¼åŠŸèƒ½ä¸ºç”¨æˆ·æä¾›äº†ï¼š

- **ğŸ¨ ä¸°å¯Œé€‰æ‹©**ï¼š6ç§é¢„è®¾æ ·å¼æ»¡è¶³ä¸åŒéœ€æ±‚
- **âš™ï¸ çµæ´»é…ç½®**ï¼šæ¯ç§æ ·å¼éƒ½æœ‰å¯è°ƒå‚æ•°
- **ğŸ–±ï¸ å‹å¥½ç•Œé¢**ï¼šç›´è§‚çš„æ ·å¼é€‰æ‹©èœå•
- **ğŸ“± å®Œç¾é€‚é…**ï¼šæ”¯æŒæ‰€æœ‰è®¾å¤‡å°ºå¯¸
- **âš¡ é«˜æ€§èƒ½**ï¼šä¼˜åŒ–çš„SVGæ¸²æŸ“æœºåˆ¶
- **ğŸ§ª å…¨é¢æµ‹è¯•**ï¼šå®Œæ•´çš„æµ‹è¯•éªŒè¯ä½“ç³»

ç°åœ¨ç”¨æˆ·å¯ä»¥æ ¹æ®ä¸åŒçš„æ ‡è®°éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„ä¸‹åˆ’çº¿æ ·å¼ï¼Œå¤§å¤§æå‡äº†æ ‡è®°çš„çµæ´»æ€§å’Œè¡¨ç°åŠ›ï¼ğŸ‰