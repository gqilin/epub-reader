<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>位置保持功能演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .controls {
            padding: 20px;
            background: #333;
            color: white;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .control-group label {
            font-size: 14px;
            white-space: nowrap;
        }
        .control-group select, .control-group button {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            background: white;
            color: #333;
            cursor: pointer;
        }
        .control-group button {
            background: #007bff;
            color: white;
        }
        .control-group button:hover {
            background: #0056b3;
        }
        .content-wrapper {
            display: flex;
            height: 600px;
        }
        .toc-area {
            width: 250px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            padding: 20px;
        }
        .content-area {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: white;
        }
        .metadata-area {
            padding: 20px;
            background: #e9ecef;
            border-bottom: 1px solid #dee2e6;
        }
        .reading-info {
            padding: 10px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            color: #666;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label>阅读模式:</label>
                <select id="readingMode">
                    <option value="scroll">滚动模式</option>
                    <option value="page">翻页模式</option>
                </select>
            </div>
            <div class="control-group">
                <label>分栏:</label>
                <select id="columnLayout">
                    <option value="single">单栏</option>
                    <option value="double">双栏</option>
                </select>
            </div>
            <div class="control-group">
                <label>文本流动:</label>
                <select id="textFlow">
                    <option value="enabled">启用</option>
                    <option value="disabled">禁用</option>
                </select>
            </div>
            <div class="control-group">
                <button id="loadSample">加载示例内容</button>
            </div>
        </div>

        <div class="metadata-area" id="metadataArea">
            <h2>位置保持功能演示</h2>
            <p>这个页面演示了在滚动和翻页模式之间切换时保持阅读位置的功能。</p>
        </div>

        <div class="content-wrapper">
            <div class="toc-area" id="tocArea">
                <h3>示例目录</h3>
                <div id="tocContent"></div>
            </div>
            <div class="content-area" id="contentArea"></div>
        </div>

        <div class="reading-info" id="readingInfo">
            请加载示例内容开始测试
        </div>
    </div>

    <script src="../dist/epubreader.js"></script>
    <script>
        let viewer;
        let currentPosition = 0;

        // 初始化阅读器
        function initViewer() {
            viewer = new EPUBReader.EPUBReaderMain({
                container: document.querySelector('.container'),
                contentArea: document.getElementById('contentArea'),
                tocArea: document.getElementById('tocArea'),
                metadataArea: document.getElementById('metadataArea'),
                readingMode: 'scroll',
                columnLayout: 'single',
                textFlow: true,
                fontSize: '16px',
                fontFamily: '"Microsoft YaHei", "PingFang SC", sans-serif',
                lineHeight: '1.8'
            });

            // 监听章节变化
            viewer.onChapterChange = (chapter) => {
                updateReadingInfo();
            };

            // 监听加载完成
            viewer.onLoad = () => {
                updateReadingInfo();
            };
        }

        // 加载示例内容
        function loadSampleContent() {
            // 创建示例章节数据
            const chapters = [
                {
                    id: 'chapter1',
                    href: 'chapter1.html',
                    title: '第一章：位置保持功能介绍',
                    content: generateSampleContent(1, '位置保持功能')
                },
                {
                    id: 'chapter2', 
                    href: 'chapter2.html',
                    title: '第二章：滚动模式详解',
                    content: generateSampleContent(2, '滚动模式')
                },
                {
                    id: 'chapter3',
                    href: 'chapter3.html', 
                    title: '第三章：翻页模式详解',
                    content: generateSampleContent(3, '翻页模式')
                }
            ];

            // 模拟书籍数据
            const mockBook = {
                title: '位置保持功能演示',
                creator: 'EPUBReader',
                chapters: chapters
            };

            // 手动设置章节数据
            viewer.reader.chapters = chapters;
            viewer.book = mockBook;
            viewer.isLoaded = true;

            // 渲染目录
            viewer.renderTOC();

            // 加载第一章
            viewer.loadChapter('chapter1');
        }

        // 生成示例内容
        function generateSampleContent(chapterNum, topic) {
            let content = `<h2>第${chapterNum}章：${topic}</h2>`;
            
            // 添加多个段落
            for (let i = 1; i <= 20; i++) {
                content += `
                    <h3>第${i}节：${topic}的特性</h3>
                    <p>这是第${i}节的内容。${topic}是EPUB阅读器中非常重要的功能。</p>
                    <p>在这一节中，我们将详细讨论${topic}的各种特性和使用方法。通过合理使用这些功能，用户可以获得更好的阅读体验。</p>
                    <p>当你滚动到大约中间位置时，可以尝试切换阅读模式，你会发现位置被很好地保持了。</p>
                    <p>继续添加更多内容，让页面变得足够长，这样可以更好地测试位置保持功能。</p>
                `;
            }
            
            return content;
        }

        // 更新阅读信息
        function updateReadingInfo() {
            const info = document.getElementById('readingInfo');
            if (viewer && viewer.contentArea) {
                if (viewer.settings.readingMode === 'scroll') {
                    const scrollTop = viewer.contentArea.scrollTop;
                    const scrollHeight = viewer.contentArea.scrollHeight;
                    const clientHeight = viewer.contentArea.clientHeight;
                    const progress = scrollHeight > clientHeight ? (scrollTop / (scrollHeight - clientHeight) * 100).toFixed(1) : 0;
                    info.textContent = `滚动模式 | 滚动位置: ${scrollTop}px | 阅读进度: ${progress}%`;
                } else {
                    info.textContent = `翻页模式 | 当前页: ${viewer.currentPage + 1}/${viewer.totalPages}`;
                }
            }
        }

        // 绑定控件事件
        function bindEvents() {
            // 阅读模式切换
            document.getElementById('readingMode').addEventListener('change', (e) => {
                viewer.setReadingMode(e.target.value);
                setTimeout(updateReadingInfo, 200);
            });

            // 分栏切换
            document.getElementById('columnLayout').addEventListener('change', (e) => {
                viewer.setColumnLayout(e.target.value);
                setTimeout(updateReadingInfo, 200);
            });

            // 文本流动切换
            document.getElementById('textFlow').addEventListener('change', (e) => {
                viewer.setTextFlow(e.target.value === 'enabled');
                setTimeout(updateReadingInfo, 200);
            });

            // 加载示例内容
            document.getElementById('loadSample').addEventListener('click', loadSampleContent);

            // 监听滚动事件更新进度
            setInterval(updateReadingInfo, 500);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            initViewer();
            bindEvents();
        });
    </script>
</body>
</html>